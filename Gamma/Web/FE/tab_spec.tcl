  set ::goal_icon_gray {<svg enable-background="new 0 0 200 200" height="32px"  version="1.1" viewBox="0 0 200 200" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" ><g><path d="M106.582,63.015c-4.273,4.856-7.285,9.74-8.877,14.553c-0.502,1.523-0.854,3.021-1.063,4.488   c-2.215-0.544-4.521-0.837-6.898-0.837c-16.009,0-29.036,13.028-29.036,29.036c0,16.01,13.026,29.034,29.036,29.034   c16.009,0,29.034-13.024,29.034-29.034c0-2.375-0.291-4.686-0.835-6.9c6.094-0.852,12.553-4.224,19.045-9.933   c1.877,5.267,2.906,10.931,2.906,16.833c0,27.652-22.499,50.152-50.15,50.152c-27.654,0-50.152-22.5-50.152-50.152   c0-27.653,22.498-50.15,50.152-50.15C95.649,60.104,101.318,61.136,106.582,63.015z M162.652,57.992   c-3.902,7.567-8.006,14.359-12.231,20.235c5.071,9.567,7.946,20.466,7.946,32.028c0,37.843-30.779,68.626-68.623,68.626   c-37.84,0-68.626-30.783-68.626-68.626c0-37.841,30.786-68.627,68.626-68.627c11.563,0,22.465,2.879,32.035,7.951   c5.856-4.217,12.632-8.319,20.224-12.234c-14.728-10.588-32.775-16.833-52.259-16.833C40.259,20.512,0,60.773,0,110.255   c0,49.485,40.259,89.744,89.744,89.744c49.481,0,89.743-40.259,89.743-89.744C179.487,90.771,173.241,72.722,162.652,57.992z    M92.301,97.312c-0.827-0.167-1.682-0.254-2.557-0.254c-7.28,0-13.197,5.92-13.197,13.198c0,7.278,5.917,13.197,13.197,13.197   c7.278,0,13.198-5.919,13.198-13.197c0-0.875-0.09-1.729-0.25-2.556l-8.962,6.983c-1.044,0.816-2.354,1.269-3.688,1.269   c-1.598,0-3.106-0.625-4.238-1.756c-2.135-2.138-2.344-5.549-0.485-7.928L92.301,97.312z" fill="#f0f0f0"/><path d="M168.587,36.007c6.827,1.365,21.227,3.238,27.908-3.444c10.069-10.07-3.803-25.252-13.385-15.674   c9.582-9.578-5.603-23.454-15.676-13.384c-6.678,6.68-4.805,21.079-3.442,27.906l-3.439,3.44   c-48.37,20.299-64.252,44.289-56.816,56.846l-14.027,17.998c-0.129,0.167-0.117,0.406,0.035,0.561   c0.152,0.154,0.394,0.165,0.564,0.033l17.996-14.022c12.551,7.433,36.543-8.446,56.844-56.819L168.587,36.007z" fill="#f0f0f0" /></g></svg>}
  set ::goal_icon_black {<svg enable-background="new 0 0 200 200" height="32px"  version="1.1" viewBox="0 0 200 200" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" ><g><path d="M106.582,63.015c-4.273,4.856-7.285,9.74-8.877,14.553c-0.502,1.523-0.854,3.021-1.063,4.488   c-2.215-0.544-4.521-0.837-6.898-0.837c-16.009,0-29.036,13.028-29.036,29.036c0,16.01,13.026,29.034,29.036,29.034   c16.009,0,29.034-13.024,29.034-29.034c0-2.375-0.291-4.686-0.835-6.9c6.094-0.852,12.553-4.224,19.045-9.933   c1.877,5.267,2.906,10.931,2.906,16.833c0,27.652-22.499,50.152-50.15,50.152c-27.654,0-50.152-22.5-50.152-50.152   c0-27.653,22.498-50.15,50.152-50.15C95.649,60.104,101.318,61.136,106.582,63.015z M162.652,57.992   c-3.902,7.567-8.006,14.359-12.231,20.235c5.071,9.567,7.946,20.466,7.946,32.028c0,37.843-30.779,68.626-68.623,68.626   c-37.84,0-68.626-30.783-68.626-68.626c0-37.841,30.786-68.627,68.626-68.627c11.563,0,22.465,2.879,32.035,7.951   c5.856-4.217,12.632-8.319,20.224-12.234c-14.728-10.588-32.775-16.833-52.259-16.833C40.259,20.512,0,60.773,0,110.255   c0,49.485,40.259,89.744,89.744,89.744c49.481,0,89.743-40.259,89.743-89.744C179.487,90.771,173.241,72.722,162.652,57.992z    M92.301,97.312c-0.827-0.167-1.682-0.254-2.557-0.254c-7.28,0-13.197,5.92-13.197,13.198c0,7.278,5.917,13.197,13.197,13.197   c7.278,0,13.198-5.919,13.198-13.197c0-0.875-0.09-1.729-0.25-2.556l-8.962,6.983c-1.044,0.816-2.354,1.269-3.688,1.269   c-1.598,0-3.106-0.625-4.238-1.756c-2.135-2.138-2.344-5.549-0.485-7.928L92.301,97.312z" fill="#000000"/><path d="M168.587,36.007c6.827,1.365,21.227,3.238,27.908-3.444c10.069-10.07-3.803-25.252-13.385-15.674   c9.582-9.578-5.603-23.454-15.676-13.384c-6.678,6.68-4.805,21.079-3.442,27.906l-3.439,3.44   c-48.37,20.299-64.252,44.289-56.816,56.846l-14.027,17.998c-0.129,0.167-0.117,0.406,0.035,0.561   c0.152,0.154,0.394,0.165,0.564,0.033l17.996-14.022c12.551,7.433,36.543-8.446,56.844-56.819L168.587,36.007z" fill="#000000" /></g></svg>}
  <script> 
      puts $::HTML {window.onload = initForm; }
      set tech_list {}
      foreach tech [array names ::tech_names] {
          append tech_list "\"$tech\""
      }
      set topology_js_list {}
      set topology_list {}
      set ::spec_js_code {}
      set ::ajax_send_code {}
      foreach topology_path [glob $::env(RAMSPICE)/Etc/Templates/*] {
          skip {![file exists $topology_path/data.tcl]}
          set topology [file tail $topology_path]
	  lappend topology_list $topology
      }
      set  topology_list [lsort $topology_list]
      foreach topology $topology_list {
 	  append topology_js_list "\"$topology\""
	  array unset ::properties
	  source $::env(RAMSPICE)/Etc/Templates/$topology/data.tcl
	  Info: properties=[array names ::properties *,html]
	  set ::topologies($topology,properties) {}
	  foreach key [array names ::properties *,html] {
	      lappend ::topologies($topology,properties) [lindex [split $key ,] 0]
	  }
	  foreach key [array names ::properties] {
	      set ::topologies($topology,$key) $::properties($key)
	  }
	  append ::spec_js_code "\nif (selected_topology==\"$topology\") \{\n"
	  append ::ajax_send_code "\nif (selected_topology==\"$topology\") \{\n    url = \"?ajax=1&selected_tech=\" + escape(selected_tech) + \"&selected_axes=\" + escape(selected) + \"&selected_g=\" + escape(selected_g) + \"&selected_topology=\" + escape(selected_topology)"
	  append ::spec_js_code "   document.getElementById(\"SpecForm\").innerHTML='"
	  append ::spec_js_code {<form action="#" id="SpecForm" onChange = "SendSpecToServer();">}
	  append ::spec_js_code "<table><tr><td>&nbsp\;</td></tr><tr><td bgcolor=$::colors(red)>X</td><td bgcolor=$::colors(orange)>Y</td><td bgcolor=$::colors(red)>Z</td><td bgcolor=$::colors(orange)>Goals</td><td colspan=\"3\" bgcolor=$::colors(red)><b>Thresholds:</b></td><td id=\"AnalysisWindox\" rowspan=\"[expr [llength $::topologies($topology,properties)]+1]\">"
	  set ::web_output ::spec_js_code
	  draw_schematic $topology
	  set ::web_output 1
	  append ::spec_js_code "</td></tr>"
	  set i 0
	  foreach property $::property_list {
	      set color [lindex {yellow orange} [expr $i%2]] 
	      incr i
	      set value {}
	      if {[info exists ::SESSION($property)]} {
	          set value "value=\"$::SESSION($property)\""
	      }
	      if {$property=="Name"} {
	          append ::spec_js_code "<tr bgcolor=$::colors($color)><td></td><td></td><td></td><td></td><td><b>$::topologies($topology,$property,html)</b></td><td><input style=\"width:69px\" type=\"string\" id=\"$property\"  $value onChange=\"SendSpecToServer()\;\"></td><td><b>$::topologies($topology,$property,unit)</b></td></tr>"
	      } else {
	          append ::spec_js_code "<tr bgcolor=$::colors($color)><td id=\"X_${topology}_$property\" onclick=\"toggle_axis(0,\\\'${topology}_$property\\\')\;\"><font color=\"#f0f0f0\">X</font></td>"
		  append ::spec_js_code "<td id=\"Y_${topology}_$property\" onclick=\"toggle_axis(1,\\\'${topology}_$property\\\')\;\"><font color=\"#f0f0f0\">Y</font></td>"
		  append ::spec_js_code "<td id=\"Z_${topology}_$property\" onclick=\"toggle_axis(2,\\\'${topology}_$property\\\')\;\"><font color=\"#f0f0f0\">Z</font></td>"
		  append ::spec_js_code "<td id=\"G_${topology}_$property\" onclick=\"toggle_g(\\\'${topology}_$property\\\')\;\">$::goal_icon_gray</td>"
		  append ::spec_js_code "<td><b>$::topologies($topology,$property,html)</b></td><td><input style=\"width:70px\"  type=\"number\" id=\"$property\"  $value onChange=\"SendSpecToServer()\;\"></td>"
		  append ::spec_js_code "<td width=\"69px\"><b>$::topologies($topology,$property,unit)</b></td></tr>"
	      }
	      append ::ajax_send_code "+ \"&$property=\" + escape(document.getElementById(\"$property\").value)"
	  }
	  append ::spec_js_code "<tr><td></td><td></td><td></td><td></td><td colspan=\"3\" align=\"center\" id=\"AnalysisHint\"></td></tr>"
	  append ::spec_js_code "</table>"
	  append ::spec_js_code "</form>'\;\n    update_analysis()\;\n\}"
	  append ::ajax_send_code "\;\n\}"
      }
      regsub -all {""} $tech_list {","} tech_list
      regsub -all {""} $topology_js_list {","} topology_js_list
      puts $::HTML "var tech_array = \[$tech_list\]\;"
      puts $::HTML "var topology_array = \[$topology_js_list\]\;"
      function update_analysis() {
	  var i;
	  for (i=0;i<selected.length;i++) {
          if (!document.getElementById(axes[i]+"_"+selected[i])) {
	      selected[i]="none";
	  }
	  }
          var win=document.getElementById("AnalysisHint");
         if ((selected[0]=="none")||(selected[1]=="none")) {
	     win.innerHTML='<font color=\"red\">Select X and Y axes to see Pareto analysis.</font>';
	     return;
	 }
         if (selected[2]=="none") {
	     win.innerHTML='hint: Select a Z axis to see heatmap.';
	     return;
	}
	win.innerHTML="";
      }
      function toggle_axis(dim,id) {
          var D=axes[dim];
          var inst=document.getElementById(D+"_"+ id);
          var selected_inst=document.getElementById(D+"_"+selected[dim]);
          if (!selected_inst) {
	      selected[dim]="none";
	  }
	  var i;
	  for (i=0;i<selected.length;i++) {
	      if (i==dim) continue;
	      if (id==selected[i]) toggle_axis(i,id);
	  }
          if (id==selected[dim]) {
	      inst.innerHTML="<font color='#f0f0f0'>"+D+"</font>";
	      selected[dim]="none";
	  } else {
	      if (selected[dim]!="none") {
	          selected_inst.innerHTML="<font color='#f0f0f0'>"+dim+"</font>";
	      }
	      inst.innerHTML="<font color='#000000'>"+D+"</font>";
	      selected[dim]=id;
	  }
	  update_analysis();
	  SendSpecToServer();
      }
     function toggle_g(id) {
	  var i;
	  var selected=0;
	  var inst=document.getElementById("G_"+id);
	  for (i=0;i<selected_g.length;i++) {
	      if (selected_g[i]==id) {
	          document.getElementById("G_"+selected_g[i]).innerHTML='$::goal_icon_gray';
		  selected_g[i]=selected_g[selected_g.length-1];
		  selected_g.pop();
 	          update_analysis();
	          SendSpecToServer();
		  return
	      }
	  }
	  inst.innerHTML='$::goal_icon_black';
	  selected_g.push(id);
 	  update_analysis();
	  SendSpecToServer();
      }
      function PopAjaxResponse() {
          if (xhr.readyState==4) {
	     if (xhr.status==200) {
          var allProperties=xhr.responseText;
	  
          document.getElementById("AnalysisWindox").innerHTML=allProperties;
	  }
	  }
	  
      }
      function LaunchJob() { 
          // Build the URL to connect to 
          var url = "?ajax=1&launch=1"
         // Open a connection to the server 
          xhr.open ("GET", url, true); s
          // Setup a function for the server to run when it is done 
    //      xhr.onreadystatechange = updatePage; 
         // Send the request 
          xhr.send(null); 
    } 
       function SendSpecToServer() { 
           // Build the URL to connect to 
          var url = ""
	  $::ajax_send_code
         // Open a connection to the server 
          xhr.open ("GET", url, true); 
          // Setup a function for the server to run when it is done 
          xhr.onreadystatechange = PopAjaxResponse; 
         // Send the request 
          xhr.send(null); 
    } 
   function UpdateTech() {
	if (document.getElementById("TechSelectForm").selectedIndex>=0) {
	    selected_tech = tech_array\[document.getElementById("TechSelectForm").selectedIndex\]\;
	    document.getElementById("TechRequest").innerHTML="<b>Technology:</b>"\;
	    if (selected_topology=="none") {
    	        document.getElementById("TopologyRequest").innerHTML="<font color=red>Now, select topology:</font>"\;
	    }
	}
      }
      function UpdateTopology() {
	if (document.getElementById("TopologySelectForm").selectedIndex>=0) {
	    selected_topology = topology_array\[document.getElementById("TopologySelectForm").selectedIndex\]\;
	    document.getElementById("TopologyRequest").innerHTML="<b>Topology:</b>"\;
	    $::spec_js_code
	}
	update_analysis();
      }
      
      set ::restore_session_code {}
      if {[info exists ::SESSION(selected_tech)]} {
          append ::restore_session_code "i=[lsearch [array names ::tech_names] $::SESSION(selected_tech)]\;\n"
          append ::restore_session_code "selected_tech=\"$::SESSION(selected_tech)\"\;\n"
          append ::restore_session_code "document.getElementById(\"TechSelectForm\").selectedIndex\=i\;\n"
          append ::restore_session_code "document.getElementById(\"TechRequest\").innerHTML=\"<b>Technology:</b>\"\;\n"
      }
      if {[info exists ::SESSION(selected_topology)]} {
          append ::restore_session_code "i=[lsearch $topology_list $::SESSION(selected_topology)]\;\n"
          append ::restore_session_code "selected_topology=\"$::SESSION(selected_topology)\"\;"
          append ::restore_session_code "document.getElementById(\"TopologySelectForm\").selectedIndex\=i\;"
          append ::restore_session_code "document.getElementById(\"TopologyRequest\").innerHTML=\"<b>Topology:</b>\"\;\n$::spec_js_code\n"
      }
      function initForm() {
              var i=-1;
	      document.getElementById("TechSelectForm").selectedIndex = -1\;
	      document.getElementById("TechSelectForm").onchange = UpdateTech\;
	      document.getElementById("TopologySelectForm").selectedIndex = -1\;
	      document.getElementById("TopologySelectForm").onchange = UpdateTopology\;
	      $::restore_session_code
      }
  </script>
  
  
  
  <table> 
  <tr>
  <td id="TechRequest"><font color=red>First, Select Technology:</font></td>
  <td>
<form action="#">
  <select id="TechSelectForm">
      set i 0
      foreach tech [array names ::tech_names] {
          puts $::HTML "<option value=\"$i\">$::tech_names($tech)</option>"
          incr i
      }
  </select>
</form>
  </td>
  </tr>
  <tr>
  <td id="TopologyRequest">
  puts $::HTML "&nbsp;"
  </td>
  <td>
  <select id="TopologySelectForm">
      set i 0
      foreach topology [lsort $topology_list] {
          source $::env(RAMSPICE)/Etc/Templates/$topology/data.tcl
          puts $::HTML "<option value=\"$i\">$input_type $title</option>"
          incr i
      }
  </select>
  </td>
  </tr>
  <tr><td id="SpecForm" colspan="2">
  </td></tr>
  <tr><td></td></tr>
  </table>
